
> poros-backend@4.1.0 start
> node server.js

âœ… CacheService initialized
âœ… Spark AI API configured (v4.10)
ğŸ”‘ APPID: bffdd85c...
âœ… Table customers created or verified
âœ… Table communication_plans created or verified
âœ… Table communication_records created or verified
âœ… Table investment_plans created or verified
âœ… Table market_data created or verified
âœ… Database connection established (v4.10)
âœ… Database initialized successfully
ğŸ”§ Running database fixes...
ğŸ”§ ä¿®å¤å¹¶åˆå§‹åŒ–æ•°æ®åº“...
âœ… Table customers created or verified
âœ… Table communication_plans created or verified
âœ… Table communication_records created or verified
âœ… Table investment_plans created or verified
âœ… Table market_data created or verified
âœ… Database connection established (v4.10)
ğŸ§¹ æ¸…ç©ºç°æœ‰æ•°æ®...
âœ… æ•°æ®åº“è¡¨ç»“æ„å·²ä¿®å¤
ğŸ“ æ·»åŠ é€šè®¯æ¨¡æ¿...
âœ… æ·»åŠ äº† 3 ä¸ªé€šè®¯æ¨¡æ¿
ğŸ”§ æ£€æŸ¥communication_plansè¡¨ç»“æ„...
å½“å‰è¡¨ç»“æ„: [
  'id',                'customer_id',
  'plan_name',         'description',
  'frequency',         'next_contact_date',
  'status',            'priority',
  'notes',             'created_at',
  'updated_at',        'manager_id',
  'plan_type',         'contact_method',
  'last_contact_date', 'next_follow_up_date',
  'assigned_to',       'is_active',
  'completion_status', 'target_date',
  'agenda',            'objectives',
  'title',             'channel',
  'target_frequency',  'priority_level'
]
âœ… communication_plansè¡¨ç»“æ„æ£€æŸ¥å®Œæˆ
ğŸ”§ æ£€æŸ¥communication_recordsè¡¨ç»“æ„...
å½“å‰communication_recordsè¡¨ç»“æ„: [
  'id',                 'customer_id',
  'plan_id',            'manager_id',
  'contact_date',       'contact_type',
  'duration_minutes',   'location',
  'summary',            'key_discussions',
  'decisions_made',     'commitments',
  'action_items',       'satisfaction_rating',
  'follow_up_required', 'follow_up_date',
  'documents',          'next_contact_scheduled',
  'next_contact_date',  'status',
  'created_at',         'updated_at',
  'notes',              'outcome',
  'next_steps',         'meeting_type',
  'participants',       'attachments',
  'is_ai_generated',    'ai_confidence_score',
  'tags',               'priority',
  'completion_status',  'reminder_sent',
  'last_modified_by',   'external_id',
  'metadata',           'next_action'
]
âœ… communication_recordsè¡¨ç»“æ„æ£€æŸ¥å®Œæˆ
ğŸ‘¥ æ£€æŸ¥å®¢æˆ·æ•°æ®...
âœ… å®¢æˆ·æ•°æ®å·²å­˜åœ¨
ğŸ“‹ æ·»åŠ é€šè®¯è®¡åˆ’...
âœ… æ·»åŠ äº† 3 ä¸ªé€šè®¯è®¡åˆ’
ğŸ” è·å–é€šè®¯è®¡åˆ’ID...
é€šè®¯è®¡åˆ’IDæ˜ å°„:
  - CUST_001: å­£åº¦æŠ•èµ„ç»„åˆå®¡æŸ¥ -> ID: 24
  - CUST_002: æœˆåº¦å¸‚åœºæ›´æ–° -> ID: 25
  - CUST_003: å¹´åº¦è´¢å¯Œè§„åˆ’ -> ID: 26
ğŸ“ æ·»åŠ é€šè®¯è®°å½•...
âœ… æ·»åŠ äº† 2 æ¡é€šè®¯è®°å½•
â° æ·»åŠ æé†’æ•°æ®...
âœ… æ·»åŠ äº† 3 ä¸ªæé†’
ğŸ‘¥ æ·»åŠ å›¢é˜Ÿæ•°æ®...
âœ… æ·»åŠ äº† 3 ä¸ªå›¢é˜Ÿæˆå‘˜

ğŸ‰ æ•°æ®åº“ä¿®å¤å’Œç§å­æ•°æ®æ·»åŠ å®Œæˆï¼
ğŸ“Š æ•°æ®ç»Ÿè®¡:
  - å®¢æˆ·: 7
  - é€šè®¯è®¡åˆ’: 3
  - é€šè®¯è®°å½•: 2
  - æé†’: 3
  - æ¨¡æ¿: 3
âœ… Database connection closed
âœ… Database fixes completed
âœ… è®¯é£æ˜Ÿç«å¤§æ¨¡å‹æœåŠ¡å·²å°±ç»ª
âœ… è®¯é£æ˜Ÿç« API é…ç½®å®Œæˆ
ğŸ“Š Starting market data updates...
âœ… Market data service started
ğŸš€ Poros Backend API running on port 3001
ğŸ¢ Company: Poros Technologies
ğŸŒ Environment: development
ğŸ“Š Health check: http://localhost:3001/api/health
âœ… Market data updated: 8 symbols
[2025-12-30T14:35:01.051Z] POST /api/communications/records - ::ffff:127.0.0.1
âœ… Table customers created or verified
âœ… Table communication_plans created or verified
âœ… Table communication_records created or verified
âœ… Table investment_plans created or verified
âœ… Table market_data created or verified
âœ… Database connection established (v4.10)
Creating communication record with data: {
  customer_id: 'CUST_001',
  plan_id: 18,
  manager_id: 'current_user',
  contact_date: '2025-12-30T14:35:01.100Z',
  contact_type: 'è§†é¢‘ä¼šè®®',
  duration_minutes: 60,
  location: null,
  summary: 'æµ‹è¯•æ·»åŠ çš„æ²Ÿé€šè®°å½•',
  key_discussions: 'è®¨è®ºæŠ•èµ„ç­–ç•¥',
  decisions_made: null,
  commitments: null,
  action_items: null,
  satisfaction_rating: 5,
  follow_up_required: false,
  follow_up_date: null,
  documents: '[]',
  next_contact_scheduled: false,
  next_contact_date: null,
  status: 'completed'
}
Data types: {
  customer_id: 'string',
  plan_id: 'number',
  manager_id: 'string',
  contact_date: 'string',
  contact_type: 'string',
  duration_minutes: 'number',
  location: 'object',
  summary: 'string',
  key_discussions: 'string',
  decisions_made: 'object',
  commitments: 'object',
  action_items: 'object',
  satisfaction_rating: 'number',
  follow_up_required: 'boolean',
  follow_up_date: 'object',
  documents: 'string',
  next_contact_scheduled: 'boolean',
  next_contact_date: 'object',
  status: 'string'
}
[2025-12-30T14:35:01.199Z] POST /api/communications/records - [32m201[0m - 148ms
[2025-12-30T14:35:05.553Z] POST /api/advice/spark-advice - ::ffff:127.0.0.1
ğŸ“‹ æ”¶åˆ°AIå»ºè®®ç”Ÿæˆè¯·æ±‚: { customer_id: 'CUST_001', user_selections: undefined }
âœ… æ‰¾åˆ°å®¢æˆ·: å¼ ä¸‰ (ID: CUST_001)
ğŸ“Š å®¢æˆ·è¯¦ç»†ä¿¡æ¯å·²å‡†å¤‡å®Œæˆï¼ŒåŒ…å«ï¼š
   - åŸºæœ¬ä¿¡æ¯: å¼ ä¸‰, 35å², Employee
   - è¡Œä¸šèƒŒæ™¯: Professional Services (0å¹´ç»éªŒ)
   - æ”¶å…¥æƒ…å†µ: å¹´æ”¶å…¥HKD 0
   - æŠ•èµ„ç»„åˆ: 0 ä¸ªæŠ•èµ„ç»„åˆï¼Œ0 ä¸ªæŠ•èµ„è®¡åˆ’
ğŸ¤– Using Spark AI to generate investment advice (v4.10)...
ğŸš€ å¼€å§‹è°ƒç”¨è®¯é£æ˜Ÿç«å¤§æ¨¡å‹ API (v4.4)...
ğŸ“¤ å‘é€è¯·æ±‚åˆ°: https://spark-api-open.xf-yun.com/v2/chat/completions
ğŸ“¥ å“åº”çŠ¶æ€: 401
âŒ APIè¯·æ±‚å¤±è´¥: {"message":"HMAC signature cannot be verified:enforced header 'date' not used for signature creation"}
ğŸ”„ å°è¯•ä½¿ç”¨ç®€åŒ–è®¤è¯...
âš ï¸ æ‰€æœ‰è®¤è¯æ–¹å¼éƒ½å¤±è´¥ï¼Œä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®
[2025-12-30T14:35:05.841Z] POST /api/advice/spark-advice - [32m200[0m - 288ms
[2025-12-30T14:36:46.090Z] GET /api/communications/dashboard - ::1
[2025-12-30T14:36:46.135Z] GET /api/communications/dashboard - [32m200[0m - 45ms
[2025-12-30T14:36:46.140Z] GET /api/advice/customers - ::1
[2025-12-30T14:36:46.147Z] GET /api/advice/customers - [32m200[0m - 7ms
[2025-12-30T14:36:46.149Z] POST /api/advice/spark-advice - ::1
ğŸ“‹ æ”¶åˆ°AIå»ºè®®ç”Ÿæˆè¯·æ±‚: {
  customer_id: 'CUST_007',
  user_selections: { investment_goal: 'Asset Growth', investment_period: '3 years' }
}
âœ… æ‰¾åˆ°å®¢æˆ·: å´ä¹ (ID: CUST_007)
ğŸ“Š å®¢æˆ·è¯¦ç»†ä¿¡æ¯å·²å‡†å¤‡å®Œæˆï¼ŒåŒ…å«ï¼š
   - åŸºæœ¬ä¿¡æ¯: å´ä¹, 39å², Employee
   - è¡Œä¸šèƒŒæ™¯: Professional Services (0å¹´ç»éªŒ)
   - æ”¶å…¥æƒ…å†µ: å¹´æ”¶å…¥HKD 0
   - æŠ•èµ„ç»„åˆ: 0 ä¸ªæŠ•èµ„ç»„åˆï¼Œ0 ä¸ªæŠ•èµ„è®¡åˆ’
ğŸ¤– Using Spark AI to generate investment advice (v4.10)...
ğŸš€ å¼€å§‹è°ƒç”¨è®¯é£æ˜Ÿç«å¤§æ¨¡å‹ API (v4.4)...
ğŸ“¤ å‘é€è¯·æ±‚åˆ°: https://spark-api-open.xf-yun.com/v2/chat/completions
ğŸ“¥ å“åº”çŠ¶æ€: 401
âŒ APIè¯·æ±‚å¤±è´¥: {"message":"HMAC signature cannot be verified:enforced header 'date' not used for signature creation"}
ğŸ”„ å°è¯•ä½¿ç”¨ç®€åŒ–è®¤è¯...
âš ï¸ æ‰€æœ‰è®¤è¯æ–¹å¼éƒ½å¤±è´¥ï¼Œä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®
[2025-12-30T14:36:46.446Z] POST /api/advice/spark-advice - [32m200[0m - 297ms
[2025-12-30T14:37:18.942Z] GET /api/health - ::ffff:127.0.0.1
[2025-12-30T14:37:18.943Z] GET /api/health - [32m200[0m - 1ms
[2025-12-30T14:37:18.961Z] GET /api/communications/dashboard - ::ffff:127.0.0.1
[2025-12-30T14:37:18.962Z] GET /api/communications/dashboard - [32m200[0m - 1ms
Error: SyntaxError: Expected property name or '}' in JSON at position 1
    at JSON.parse (<anonymous>)
    at parse (/workspace/poros_4.10/backend/node_modules/body-parser/lib/types/json.js:92:19)
    at /workspace/poros_4.10/backend/node_modules/body-parser/lib/read.js:128:18
    at AsyncResource.runInAsyncScope (node:async_hooks:206:9)
    at invokeCallback (/workspace/poros_4.10/backend/node_modules/raw-body/index.js:238:16)
    at done (/workspace/poros_4.10/backend/node_modules/raw-body/index.js:227:7)
    at IncomingMessage.onEnd (/workspace/poros_4.10/backend/node_modules/raw-body/index.js:287:7)
    at IncomingMessage.emit (node:events:524:28)
    at endReadableNT (node:internal/streams/readable:1698:12)
    at process.processTicksAndRejections (node:internal/process/task_queues:82:21) {
  expose: true,
  statusCode: 400,
  status: 400,
  body: '{\\"customer_id\\": \\"CUST_001\\", \\"query\\": \\"æŠ•èµ„å»ºè®®\\"}',
  type: 'entity.parse.failed'
}
Error: SyntaxError: Expected property name or '}' in JSON at position 1
    at JSON.parse (<anonymous>)
    at parse (/workspace/poros_4.10/backend/node_modules/body-parser/lib/types/json.js:92:19)
    at /workspace/poros_4.10/backend/node_modules/body-parser/lib/read.js:128:18
    at AsyncResource.runInAsyncScope (node:async_hooks:206:9)
    at invokeCallback (/workspace/poros_4.10/backend/node_modules/raw-body/index.js:238:16)
    at done (/workspace/poros_4.10/backend/node_modules/raw-body/index.js:227:7)
    at IncomingMessage.onEnd (/workspace/poros_4.10/backend/node_modules/raw-body/index.js:287:7)
    at IncomingMessage.emit (node:events:524:28)
    at endReadableNT (node:internal/streams/readable:1698:12)
    at process.processTicksAndRejections (node:internal/process/task_queues:82:21) {
  expose: true,
  statusCode: 400,
  status: 400,
  body: '{\\"customer_id\\": \\"CUST_001\\", \\"plan_id\\": 18, \\"contact_type\\": \\"æµ‹è¯•\\", \\"summary\\": \\"æµ‹è¯•è®°å½•\\", \\"satisfaction_rating\\": 5}',
  type: 'entity.parse.failed'
}
[2025-12-30T14:37:19.017Z] GET /api/communications/dashboard - ::ffff:127.0.0.1
[2025-12-30T14:37:19.017Z] GET /api/communications/dashboard - [32m200[0m - 0ms
[2025-12-30T14:37:19.061Z] GET /api/communications/dashboard - ::ffff:127.0.0.1
[2025-12-30T14:37:19.062Z] GET /api/communications/dashboard - [32m200[0m - 1ms
Error: SyntaxError: Expected property name or '}' in JSON at position 1
    at JSON.parse (<anonymous>)
    at parse (/workspace/poros_4.10/backend/node_modules/body-parser/lib/types/json.js:92:19)
    at /workspace/poros_4.10/backend/node_modules/body-parser/lib/read.js:128:18
    at AsyncResource.runInAsyncScope (node:async_hooks:206:9)
    at invokeCallback (/workspace/poros_4.10/backend/node_modules/raw-body/index.js:238:16)
    at done (/workspace/poros_4.10/backend/node_modules/raw-body/index.js:227:7)
    at IncomingMessage.onEnd (/workspace/poros_4.10/backend/node_modules/raw-body/index.js:287:7)
    at IncomingMessage.emit (node:events:524:28)
    at endReadableNT (node:internal/streams/readable:1698:12)
    at process.processTicksAndRejections (node:internal/process/task_queues:82:21) {
  expose: true,
  statusCode: 400,
  status: 400,
  body: '{\\"customer_id\\": \\"CUST_001\\", \\"query\\": \\"æŠ•èµ„å»ºè®®\\"}',
  type: 'entity.parse.failed'
}
[2025-12-30T14:37:26.727Z] POST /api/advice/spark-advice - ::ffff:127.0.0.1
ğŸ“‹ æ”¶åˆ°AIå»ºè®®ç”Ÿæˆè¯·æ±‚: { customer_id: 'CUST_001', user_selections: undefined }
âœ… æ‰¾åˆ°å®¢æˆ·: å¼ ä¸‰ (ID: CUST_001)
ğŸ“Š å®¢æˆ·è¯¦ç»†ä¿¡æ¯å·²å‡†å¤‡å®Œæˆï¼ŒåŒ…å«ï¼š
   - åŸºæœ¬ä¿¡æ¯: å¼ ä¸‰, 35å², Employee
   - è¡Œä¸šèƒŒæ™¯: Professional Services (0å¹´ç»éªŒ)
   - æ”¶å…¥æƒ…å†µ: å¹´æ”¶å…¥HKD 0
   - æŠ•èµ„ç»„åˆ: 0 ä¸ªæŠ•èµ„ç»„åˆï¼Œ0 ä¸ªæŠ•èµ„è®¡åˆ’
ğŸ¤– Using Spark AI to generate investment advice (v4.10)...
ğŸš€ å¼€å§‹è°ƒç”¨è®¯é£æ˜Ÿç«å¤§æ¨¡å‹ API (v4.4)...
ğŸ“¤ å‘é€è¯·æ±‚åˆ°: https://spark-api-open.xf-yun.com/v2/chat/completions
ğŸ“¥ å“åº”çŠ¶æ€: 401
âŒ APIè¯·æ±‚å¤±è´¥: {"message":"HMAC signature cannot be verified:enforced header 'date' not used for signature creation"}
ğŸ”„ å°è¯•ä½¿ç”¨ç®€åŒ–è®¤è¯...
âš ï¸ æ‰€æœ‰è®¤è¯æ–¹å¼éƒ½å¤±è´¥ï¼Œä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®
[2025-12-30T14:37:26.962Z] POST /api/advice/spark-advice - [32m200[0m - 235ms
[2025-12-30T14:37:32.863Z] POST /api/communications/records - ::ffff:127.0.0.1
Creating communication record with data: {
  customer_id: 'CUST_001',
  plan_id: 18,
  manager_id: 'current_user',
  contact_date: '2025-12-30T14:37:32.863Z',
  contact_type: 'æµ‹è¯•',
  duration_minutes: null,
  location: null,
  summary: 'æœ€ç»ˆæµ‹è¯•è®°å½•',
  key_discussions: null,
  decisions_made: null,
  commitments: null,
  action_items: null,
  satisfaction_rating: 5,
  follow_up_required: false,
  follow_up_date: null,
  documents: '[]',
  next_contact_scheduled: false,
  next_contact_date: null,
  status: 'completed'
}
Data types: {
  customer_id: 'string',
  plan_id: 'number',
  manager_id: 'string',
  contact_date: 'string',
  contact_type: 'string',
  duration_minutes: 'object',
  location: 'object',
  summary: 'string',
  key_discussions: 'object',
  decisions_made: 'object',
  commitments: 'object',
  action_items: 'object',
  satisfaction_rating: 'number',
  follow_up_required: 'boolean',
  follow_up_date: 'object',
  documents: 'string',
  next_contact_scheduled: 'boolean',
  next_contact_date: 'object',
  status: 'string'
}
[2025-12-30T14:37:32.934Z] POST /api/communications/records - [32m201[0m - 71ms
